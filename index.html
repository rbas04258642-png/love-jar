<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¬Ø±Ø© Ø§Ù„Ø­Ø¨ â¤ï¸</title>
<style>
:root {
  --bg: #fff;
  --card: #ffe6e6;
  --accent: #ff1a1a;
  --muted: #a0a0a0;
}
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans Arabic', Arial;
  background: linear-gradient(180deg, #fff0f0 0%, #fff 100%);
  color: #333;
  display: flex; justify-content: center; align-items: center;
}
.wrap {
  max-width: 960px; width: 100%;
  display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
}
.card {
  background: var(--card);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  display: flex; flex-direction: column;
}
header h1 { margin:0; font-size: 22px; color: var(--accent);}
header p { font-size: 14px; color: var(--muted); margin-top: 6px;}
.form-row { display: flex; gap:10px; margin-top:12px;}
label { font-size: 13px; color: var(--muted); margin-bottom: 4px; display:block;}
input[type=text], textarea { width:100%; padding:10px; border-radius:8px;
  border:1px solid rgba(255,0,0,0.2); background: #fff; color:#333; font-size:14px;
}
textarea { min-height:80px; resize: vertical;}
button {
  background: var(--accent); border:0; padding:10px 14px; border-radius:10px; color:white;
  cursor:pointer; font-weight:600;
}
.actions { display:flex; gap:10px; margin-top:10px;}
.list { max-height:180px; overflow:auto; margin-top:10px; padding:8px;
  border-radius:8px; background:rgba(255,0,0,0.05);}
.msg { padding:8px; border-radius:8px; background: rgba(255,255,255,0.7);
  margin-bottom:6px; cursor:pointer; display:flex; align-items:center; gap:6px;}
.jar-stage { display:flex; flex-direction: column; align-items:center; gap:12px; padding:10px;}
.jar { width:100%; max-width:280px; aspect-ratio: 0.8; position: relative; }
.jar svg { width:100%; height:100%; display:block; }
.hearts { position:absolute; inset:0; pointer-events:none; }
.heart { position:absolute; font-size:24px; opacity:0; transform: translateY(60px) scale(0.6);
  animation: float 3s linear infinite;
}
@keyframes float {
0% {opacity:0; transform:translateY(120px) scale(.6);}
10% {opacity:1;}
70% {opacity:0.9; transform:translateY(-30px) scale(1);}
100% {opacity:0; transform:translateY(-80px) scale(.8);}
}
footer { font-size:12px; color: var(--muted); margin-top:10px; text-align:center;}
img.msg-img { max-width:50px; max-height:50px; border-radius:6px;}
@media(max-width:900px){ .wrap{ grid-template-columns:1fr; } }
</style>
</head>
<body>
<main class="wrap">
  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <section class="card">
    <header>
      <h1>ØµÙÙ†Ø¹ÙŠ "Ø¬Ø±Ø© Ø§Ù„Ø­Ø¨" â¤ï¸</h1>
      <p>Ø£Ø¶Ù Ø±Ø³Ø§Ø¦Ù„ØŒ ØµÙˆØ±ØŒ ÙˆØ´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£Ø­Ø¨Ø§Ø¦Ùƒ.</p>
    </header>

    <div style="margin-top:10px">
      <div class="form-row">
        <div style="flex:1">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</label>
          <input id="fromName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¨Ø§Ø³" />
        </div>
        <div style="width:140px">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</label>
          <input id="toName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø±Ø©" />
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© Ù‚ØµÙŠØ±Ø©</label>
        <textarea id="msgText" placeholder="Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ù‹Ø§ Ø¬Ù…ÙŠÙ„Ù‹Ø§..."></textarea>
        <input type="file" id="imgFile" accept="image/*" style="margin-top:6px;">
        <div class="actions">
          <button id="addBtn">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø±Ø©</button>
          <button id="clearBtn" style="background:#b0b0b0">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        </div>
      </div>

      <div class="list" id="messagesList"><em style="color:var(--muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</em></div>

      <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
        <button id="generate">Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>
        <input id="shareLink" readonly style="flex:1; padding:8px; border-radius:8px; background:#fff; border:1px solid rgba(255,0,0,0.2);" />
      </div>
      <footer>ØªÙˆÙ‚ÙŠØ¹: Ø¹Ø¨Ø§Ø³ Ø§Ù„Ø£Ø³Ø¯ÙŠ + @j45fl</footer>
    </div>
  </section>

  <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¬Ø±Ø© -->
  <aside class="card jar-stage">
    <div style="text-align:center">
      <strong id="previewTitle">Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø­Ø¨ÙŠØ¨ÙŠ â¤ï¸</strong>
      <div style="color:var(--muted); font-size:13px; margin-top:6px" id="previewSub">Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø¹Ø¯</div>
    </div>

    <div class="jar" id="jarContainer">
      <svg viewBox="0 0 200 240" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="glass" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.1" />
            <stop offset="100%" stop-color="#ffffff" stop-opacity="0.02" />
          </linearGradient>
        </defs>
        <g transform="translate(0,10)">
          <path d="M40 10 Q60 -10 100 10 Q140 -10 160 10 Q170 40 160 60 Q150 190 100 210 Q50 190 40 60 Q30 40 40 10 Z"
            fill="url(#glass)" stroke="rgba(255,0,0,0.1)" />
          <ellipse cx="100" cy="200" rx="52" ry="12" fill="rgba(255,0,0,0.1)" />
        </g>
      </svg>
      <div class="hearts" id="heartsLayer"></div>
    </div>

    <div style="width:100%; margin-top:10px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¬Ø±Ø©</strong>
        <small style="color:var(--muted)">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù†Ø³Ø®Ù‡Ø§</small>
      </div>
      <div id="previewList" style="margin-top:10px; max-height:200px; overflow:auto"></div>
    </div>
  </aside>
</main>

<script>
// Ø¹Ù†Ø§ØµØ±
const $ = id => document.getElementById(id);
let messages = [];

// Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function renderList(){
  const list = $('messagesList'); const preview = $('previewList');
  list.innerHTML=''; preview.innerHTML='';
  if(messages.length===0){ list.innerHTML='<em style="color:var(--muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</em>'; return; }
  messages.forEach((m,i)=>{
    const div = document.createElement('div'); div.className='msg';
    div.innerHTML = `${m.text} ${m.img? '<img src="'+m.img+'" class="msg-img">' : ''}`;
    div.addEventListener('click', ()=>{ navigator.clipboard?.writeText(m.text).then(()=>alert('Ù†ÙØ³Ø® Ø§Ù„Ù†Øµ')); });
    list.appendChild(div);

    const p = document.createElement('div'); p.className='msg';
    p.innerHTML = div.innerHTML;
    p.addEventListener('click', ()=>navigator.clipboard?.writeText(m.text).then(()=>alert('Ù†ÙØ³Ø® Ø§Ù„Ù†Øµ')));
    preview.appendChild(p);
  });
  updateHearts();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
function updatePreviewTitle(){
  const to = $('toName').value.trim(); const from = $('fromName').value.trim();
  $('previewTitle').textContent = to? `Ø¥Ù„Ù‰ ${to} â¤ï¸` : 'Ø¥Ù‡Ø¯Ø§Ø¡ Ø®Ø§Øµ â¤ï¸';
  $('previewSub').textContent = from? `Ù…Ù† ${from}` : 'Ø£Ø¶Ù Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„';
}

// Ù‚Ù„ÙˆØ¨ Ù…ØªØ­Ø±ÙƒØ©
function updateHearts(){
  const layer = $('heartsLayer'); layer.innerHTML='';
  const count = Math.min(12, messages.length || 6);
  for(let i=0;i<count;i++){
    const h = document.createElement('div'); h.className='heart';
    const left = Math.random()*90; const top = Math.random()*120+20;
    h.style.left = `${left}%`; h.style.top = `${top}px`;
    h.style.animationDuration = `${2+Math.random()*2}s`;
    h.style.color = `hsl(${Math.random()*20},100%,50%)`; 
    h.textContent = 'â¤ï¸';
    layer.appendChild(h);
  }
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
$('addBtn').addEventListener('click', ()=>{
  const txt = $('msgText').value.trim();
  const file = $('imgFile').files[0];
  if(!txt) return alert('Ø£Ø¯Ø®Ù„ Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹');
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      messages.unshift({text:txt, img:e.target.result});
      $('msgText').value=''; $('imgFile').value='';
      renderList();
    }
    reader.readAsDataURL(file);
  } else {
    messages.unshift({text:txt, img:null});
    $('msgText').value='';
    renderList();
  }
});

// Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
$('clearBtn').addEventListener('click', ()=>{
  if(confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ')){ messages=[]; renderList(); }
});

// Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ÙØ±ÙŠØ¯
$('generate').addEventListener('click', ()=>{
  if(messages.length===0) return alert('Ø£Ø¶Ù Ø±Ø³Ø§Ø¦Ù„ Ø£ÙˆÙ„Ø§Ù‹');
  const state = {
    from: $('fromName').value, 
    to: $('toName').value, 
    msgs: messages,
    ts: Date.now() // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙØ±ÙŠØ¯
  };
  try{
    const payload = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
    const url = `${location.origin}${location.pathname}?data=${payload}`;
    $('shareLink').value = url;
    navigator.clipboard?.writeText(url).then(()=>alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ‰'));
  }catch(e){ alert('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·'); }
});

// ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø±Ø§Ø¨Ø·
function loadFromUrl(){
  const params = new URLSearchParams(location.search);
  const d = params.get('data');
  if(!d) return;
  try{
    const json = decodeURIComponent(escape(atob(d)));
    const state = JSON.parse(json);
    document.querySelectorAll('.card')[0].style.display='none';
    $('previewTitle').textContent = state.to? `Ø¥Ù„Ù‰ ${state.to} â¤ï¸` : 'Ø¥Ù‡Ø¯Ø§Ø¡ Ø®Ø§Øµ â¤ï¸';
    $('previewSub').textContent = state.from? `Ù…Ù† ${state.from}` : '';
    messages = state.msgs || [];
    renderList();
  }catch(e){ console.error(e); }
}

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
['fromName','toName'].forEach(id => $(id).addEventListener('input', updatePreviewTitle));

// ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø±Ø§Ø¨Ø· Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
loadFromUrl();
</script>
</body>
</html>
